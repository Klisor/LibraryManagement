export const mockBooks = [
  {
    id: 1,
    isbn: '978-7-5354-1234-5',
    title: 'çº¢æ¥¼æ¢¦',
    author: 'æ›¹é›ªèŠ¹',
    publisher: 'äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾',
    publishYear: 2020,
    category: 1,
    totalCopies: 5,
    availableCopies: 3,
    location: 'AåŒº3æ’2æ¶',
    description: 'ä¸­å›½å¤å…¸æ–‡å­¦åè‘—ï¼Œæ¸…ä»£ä½œå®¶æ›¹é›ªèŠ¹åˆ›ä½œçš„é•¿ç¯‡ç« å›ä½“å°è¯´ã€‚',
    createdAt: '2024-01-01T00:00:00.000Z',
    updatedAt: '2024-01-01T00:00:00.000Z'
  },
  {
    id: 2,
    isbn: '978-7-02-001501-6',
    title: 'ä¸‰å›½æ¼”ä¹‰',
    author: 'ç½—è´¯ä¸­',
    publisher: 'äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾',
    publishYear: 2019,
    category: 1,
    totalCopies: 3,
    availableCopies: 1,
    location: 'AåŒº2æ’1æ¶',
    description: 'ä¸­å›½å¤ä»£å†å²å°è¯´',
    createdAt: '2024-01-02T00:00:00.000Z',
    updatedAt: '2024-01-02T00:00:00.000Z'
  },
  {
    id: 3,
    isbn: '978-7-02-015433-3',
    title: 'è¥¿æ¸¸è®°',
    author: 'å´æ‰¿æ©',
    publisher: 'äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾',
    publishYear: 2021,
    category: 1,
    totalCopies: 4,
    availableCopies: 4,
    location: 'AåŒº2æ’3æ¶',
    description: 'ä¸­å›½å¤å…¸ç¥é­”å°è¯´',
    createdAt: '2024-01-03T00:00:00.000Z',
    updatedAt: '2024-01-03T00:00:00.000Z'
  },
  {
    id: 4,
    isbn: '978-7-5327-8533-4',
    title: 'JavaScripté«˜çº§ç¨‹åºè®¾è®¡',
    author: 'Nicholas C. Zakas',
    publisher: 'äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾',
    publishYear: 2019,
    category: 4,
    totalCopies: 10,
    availableCopies: 6,
    location: 'BåŒº1æ’1æ¶',
    description: 'JavaScriptç»å…¸æ•™ç¨‹',
    createdAt: '2024-01-04T00:00:00.000Z',
    updatedAt: '2024-01-04T00:00:00.000Z'
  },
  {
    id: 5,
    isbn: '978-7-115-51531-8',
    title: 'Vue.jsè®¾è®¡ä¸å®ç°',
    author: 'éœæ˜¥é˜³',
    publisher: 'äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾',
    publishYear: 2022,
    category: 4,
    totalCopies: 8,
    availableCopies: 5,
    location: 'BåŒº1æ’2æ¶',
    description: 'Vue.jsæŠ€æœ¯åŸç†è¯¦è§£',
    createdAt: '2024-01-05T00:00:00.000Z',
    updatedAt: '2024-01-05T00:00:00.000Z'
  },
  {
    id: 6,
    isbn: '978-7-5442-9981-6',
    title: 'äººç±»ç®€å²',
    author: 'å°¤ç“¦å°”Â·èµ«æ‹‰åˆ©',
    publisher: 'ä¸­ä¿¡å‡ºç‰ˆç¤¾',
    publishYear: 2017,
    category: 2,
    totalCopies: 6,
    availableCopies: 2,
    location: 'CåŒº1æ’1æ¶',
    description: 'ä»åŠ¨ç‰©åˆ°ä¸Šå¸çš„äººç±»å†å²',
    createdAt: '2024-01-06T00:00:00.000Z',
    updatedAt: '2024-01-06T00:00:00.000Z'
  },
  {
    id: 7,
    isbn: '978-7-5327-7372-0',
    title: 'ç™¾å¹´å­¤ç‹¬',
    author: 'åŠ è¥¿äºšÂ·é©¬å°”å…‹æ–¯',
    publisher: 'å—æµ·å‡ºç‰ˆå…¬å¸',
    publishYear: 2011,
    category: 1,
    totalCopies: 5,
    availableCopies: 3,
    location: 'AåŒº1æ’1æ¶',
    description: 'æ‹‰ä¸ç¾æ´²é­”å¹»ç°å®ä¸»ä¹‰æ–‡å­¦ä»£è¡¨ä½œ',
    createdAt: '2024-01-07T00:00:00.000Z',
    updatedAt: '2024-01-07T00:00:00.000Z'
  },
  {
    id: 8,
    isbn: '978-7-5086-6852-7',
    title: 'åŸåˆ™',
    author: 'ç‘Â·è¾¾åˆ©æ¬§',
    publisher: 'ä¸­ä¿¡å‡ºç‰ˆç¤¾',
    publishYear: 2018,
    category: 7,
    totalCopies: 7,
    availableCopies: 4,
    location: 'DåŒº1æ’1æ¶',
    description: 'æŠ•èµ„å’Œå·¥ä½œç”Ÿæ´»åŸåˆ™',
    createdAt: '2024-01-08T00:00:00.000Z',
    updatedAt: '2024-01-08T00:00:00.000Z'
  }
];

// ç”Ÿæˆæ›´å¤šå›¾ä¹¦æ•°æ®
for (let i = 9; i <= 50; i++) {
  mockBooks.push({
    id: i,
    isbn: `978-7-${1000 + i}-${1000 + i}-${i}`,
    title: `å›¾ä¹¦ç¤ºä¾‹ ${i}`,
    author: `ä½œè€… ${Math.floor(Math.random() * 10) + 1}`,
    publisher: ['äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾', 'äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾', 'ä¸­ä¿¡å‡ºç‰ˆç¤¾', 'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'][Math.floor(Math.random() * 4)],
    publishYear: 2015 + Math.floor(Math.random() * 8),
    category: Math.floor(Math.random() * 10) + 1,
    totalCopies: Math.floor(Math.random() * 10) + 1,
    availableCopies: Math.floor(Math.random() * 10) + 1,
    location: `${String.fromCharCode(65 + Math.floor(Math.random() * 5))}åŒº${Math.floor(Math.random() * 5) + 1}æ’${Math.floor(Math.random() * 5) + 1}æ¶`,
    description: `è¿™æ˜¯ç¬¬${i}æœ¬å›¾ä¹¦çš„æè¿°å†…å®¹ã€‚`,
    createdAt: new Date(2024, 0, i).toISOString(),
    updatedAt: new Date(2024, 0, i).toISOString()
  });
}

// ç¡®ä¿ mockBooks çš„ ID æ˜¯è¿ç»­çš„
export function ensureBookIdsAreContinuous() {
  // è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
  const storedBooks = JSON.parse(localStorage.getItem('books') || 'null')
  if (storedBooks) {
    // é‡æ–°åˆ†é… IDï¼Œç¡®ä¿è¿ç»­
    const updatedBooks = storedBooks.map((book, index) => ({
      ...book,
      id: index + 1
    }))
    localStorage.setItem('books', JSON.stringify(updatedBooks))
    
    // æ›´æ–° mockBooks
    mockBooks.length = 0
    updatedBooks.forEach(book => mockBooks.push({...book}))
  }
}

// ç¡®ä¿å›¾ä¹¦æ•°æ®åˆå§‹åŒ–
export function initBookData() {
  // æ£€æŸ¥ localStorage æ˜¯å¦æœ‰å›¾ä¹¦æ•°æ®
  const storedBooks = JSON.parse(localStorage.getItem('books') || 'null')
  
  if (!storedBooks || storedBooks.length === 0) {
    // å¦‚æœæ²¡æœ‰å­˜å‚¨çš„æ•°æ®ï¼Œä½¿ç”¨ mockBooks å¹¶ä¿å­˜
    localStorage.setItem('books', JSON.stringify(mockBooks))
    console.log('ğŸ“š åˆå§‹åŒ–å›¾ä¹¦æ•°æ®åˆ° localStorageï¼Œæ•°é‡:', mockBooks.length)
  } else {
    console.log('ğŸ“š å·²å­˜åœ¨å›¾ä¹¦æ•°æ®ï¼Œæ•°é‡:', storedBooks.length)
    
    // **ä¿®å¤ï¼šç¡®ä¿IDè¿ç»­ä¸”å”¯ä¸€**
    const bookMap = new Map()
    
    // æŒ‰IDé¡ºåºå¤„ç†å›¾ä¹¦ï¼Œç¡®ä¿å”¯ä¸€æ€§
    storedBooks
      .filter(book => book && book.id)
      .sort((a, b) => Number(a.id) - Number(b.id))
      .forEach(book => {
        const numericId = Number(book.id)
        if (!isNaN(numericId) && numericId > 0) {
          // å¦‚æœIDå·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤çš„
          if (!bookMap.has(numericId)) {
            bookMap.set(numericId, {
              ...book,
              id: numericId
            })
          }
        }
      })
    
    // è½¬æ¢ä¸ºæ•°ç»„
    const mergedBooks = Array.from(bookMap.values())
    
    // æ›´æ–° localStorage
    localStorage.setItem('books', JSON.stringify(mergedBooks))
    
    console.log('ğŸ”„ åˆå¹¶å¹¶åŒæ­¥å›¾ä¹¦æ•°æ®ï¼Œå…±', mergedBooks.length, 'æœ¬')
  }
}

initBookData()